{"kind":"article","hierarchy":{"paths":[["doc:\/\/KeyboardKit\/documentation\/KeyboardKit"]]},"abstract":[{"text":"This article describes the KeyboardKit dictation engine.","type":"text"}],"metadata":{"roleHeading":"Article","modules":[{"name":"KeyboardKit"}],"title":"Dictation [BETA]","role":"article"},"identifier":{"url":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Dictation-Article","interfaceLanguage":"swift"},"sections":[],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/keyboardkit\/dictation-article"]}],"schemaVersion":{"major":0,"minor":3,"patch":0},"seeAlsoSections":[{"identifiers":["doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Actions-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/AI-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Autocomplete-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Buttons-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Callouts-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Colors-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Device-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Emojis-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Extensions-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/External-Keyboards-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Feedback-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Gestures-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Images-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Layout-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Localization-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Navigation-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Previews-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Proxy-Utilities-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Settings-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/State-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Styling-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Text-Routing-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Themes-Article","doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Views"],"title":"Features","generated":true}],"primaryContentSections":[{"content":[{"level":2,"text":"Overview","type":"heading","anchor":"overview"},{"inlineContent":[{"type":"text","text":"Dictation lets users enter text by speaking instead of typing. This can be hard to implement in a keyboard extension, where microphone access is unavailable."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"KeyboardKit therefore provides dictation-specific tools that you can use to implement dictation for both your keyboard extension and main app."}]},{"inlineContent":[{"identifier":"https:\/\/github.com\/KeyboardKit\/KeyboardKitPro","isActive":true,"type":"reference"},{"text":" unlocks dictation services that can be used to perform app- and keyboard-based dictation. Information about Pro features can be found at the end of this article.","type":"text"}],"type":"paragraph"},{"anchor":"Dictation-namespace","text":"Dictation namespace","level":2,"type":"heading"},{"type":"paragraph","inlineContent":[{"text":"KeyboardKit has a ","type":"text"},{"type":"reference","isActive":true,"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Dictation"},{"text":" namespace that contains dictation-related types.","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"This namespace doesnâ€™t have protocols, open classes, or types that are meant to be top-level."}]},{"anchor":"Dictation-context","type":"heading","text":"Dictation context","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"KeyboardKit has an observable "},{"isActive":true,"type":"reference","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/DictationContext"},{"type":"text","text":" class that handles dictation state, such as the currently dictated text, in which application dictation was started, etc."}]},{"inlineContent":[{"text":"KeyboardKit automatically creates an instance of this class and injects it into ","type":"text"},{"isActive":true,"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardInputViewController\/state","type":"reference"},{"type":"text","text":", then updates it during dictation."}],"type":"paragraph"},{"type":"heading","anchor":"Dictation-services","text":"Dictation services","level":2},{"type":"paragraph","inlineContent":[{"text":"In KeyboardKit, a ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/DictationService"},{"text":" can perform dictation where microphone access is available, while a ","type":"text"},{"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardDictationService","isActive":true,"type":"reference"},{"type":"text","text":" can do it from a keyboard extension."}]},{"inlineContent":[{"type":"text","text":"KeyboardKit doesnâ€™t have a standard dictation service. Instead, it injects a disabled service into "},{"isActive":true,"type":"reference","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardInputViewController\/services"},{"type":"text","text":" until you register a custom instance or register a KeyboardKit Pro license key."}],"type":"paragraph"},{"level":2,"type":"heading","text":"How to perform dictation","anchor":"How-to-perform-dictation"},{"inlineContent":[{"text":"Dictation works differently in applications, where microphone access is available, and in keyboards.","type":"text"}],"type":"paragraph"},{"type":"heading","level":3,"text":"How to perform dictation in an app","anchor":"How-to-perform-dictation-in-an-app"},{"type":"paragraph","inlineContent":[{"type":"text","text":"You can use a "},{"type":"reference","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/DictationService","isActive":true},{"text":" to perform dictation if microphone access is available.","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"To start dictation within an application, just call "},{"type":"reference","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/DictationService\/startDictation(with:)","isActive":true},{"text":" and observe the ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardContext"},{"text":" to see if dictation is started, to get the dictated text, fetch any errors, etc.","type":"text"}]},{"inlineContent":[{"type":"text","text":"A "},{"isActive":true,"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/DictationService","type":"reference"},{"type":"text","text":" can call "},{"isActive":true,"type":"reference","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/DictationService\/requestDictationAuthorization()"},{"text":" to ask for user permissions. You can call it manually as well, before starting the operation, to avoid interruption.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Since dictation may stop at any time, for instance due to silence, every "},{"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/DictationService","isActive":true,"type":"reference"},{"type":"text","text":" should describe how to access the dictated result."}],"type":"paragraph"},{"text":"How to perform dictation in a keyboard extension","anchor":"How-to-perform-dictation-in-a-keyboard-extension","type":"heading","level":3},{"inlineContent":[{"type":"text","text":"You can use a "},{"isActive":true,"type":"reference","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardDictationService"},{"text":" to perform dictation in a keyboard extension.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Keyboard-based dictation must open the app to start dictation or open an audio bridge, then write the dictated text to shared storage and return to the keyboard to process the result."}],"type":"paragraph"},{"inlineContent":[{"text":"This can be tricky to set up, but KeyboardKit Pro lets you configure this in a few, simple steps.","type":"text"}],"type":"paragraph"},{"name":"Important","style":"important","content":[{"type":"paragraph","inlineContent":[{"text":"iOS 17 made a previously working way of returning to the keyboard stop working. There is another way to achieve this, but Apple rejects any apps that uses it. Until a workaround is found, you must instruct your users to tap the back arrow to return to the keyboard.","type":"text"}]}],"type":"aside"},{"text":"Views","type":"heading","level":2,"anchor":"Views"},{"type":"paragraph","inlineContent":[{"type":"text","text":"KeyboardKit Pro unlocks dictation-related views, that let you inspect the dictation progress."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"A "},{"inlineContent":[{"text":"Dictation.Screen","type":"text"}],"type":"strong"},{"type":"text","text":" can be used to overlay the app to show an ongoing dictation operation. It can use any visualizer, like a "},{"type":"strong","inlineContent":[{"type":"text","text":"Dictation.BarVisualizer"}]},{"type":"text","text":"."}]},{"inlineContent":[{"type":"image","identifier":"dictationscreen-350.jpg"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"type":"strong","inlineContent":[{"text":"Dictation.BarVisualizer","type":"text"}]},{"text":" can be styled to great extent. You can change the number of bars, the colors and thickness of the bars, etc.","type":"text"}]},{"text":"ðŸ‘‘ Pro features","type":"heading","level":2,"anchor":"ðŸ‘‘-Pro-features"},{"inlineContent":[{"isActive":true,"type":"reference","identifier":"https:\/\/github.com\/KeyboardKit\/KeyboardKitPro","overridingTitleInlineContent":[{"text":"KeyboardKit Pro","type":"text"}],"overridingTitle":"KeyboardKit Pro"},{"type":"text","text":" unlocks services that let you setup and perform dictation with very little code."}],"type":"paragraph"},{"level":3,"text":"Services","type":"heading","anchor":"Services"},{"inlineContent":[{"type":"text","text":"KeyboardKit Pro unlocks a "},{"type":"strong","inlineContent":[{"type":"text","text":"ProDictationService"}]},{"type":"text","text":" service that can be used within the main app, and a "},{"type":"strong","inlineContent":[{"text":"ProKeyboardDictationService","type":"text"}]},{"type":"text","text":" that can be used to trigger dictation from the keyboard."}],"type":"paragraph"},{"level":3,"type":"heading","text":"Supported languages","anchor":"Supported-languages"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The speech recognizer that is used by KeyboardKit Pro supports the following languages:"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"English, Arabic, Catalan, Croatian, Czech, Danish, Dutch, Finnish, French, German, Greek, Hebrew, Hungarian, Indonesian, Italian, Malay, Norwegian, Polish, Portuguese, Romanian, Russian, Slovak, Spanish, Swedish, Turkish, Ukrainian"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you want to use dictation with other languages, you must implement a custom recognizer."}]},{"anchor":"Dictation-views","type":"heading","level":3,"text":"Dictation views"},{"type":"paragraph","inlineContent":[{"type":"text","text":"KeyboardKit Pro unlocks dictation-specific views, as mentioned above."}]},{"text":"How to perform dictation with KeyboardKit Pro","level":2,"anchor":"How-to-perform-dictation-with-KeyboardKit-Pro","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"KeyboardKit Pro dictation requires some basic configuration. The following text describes how to setup dictation that starts from a keyboard and performs it in the main app."}]},{"anchor":"Step-1-Set-up-required-permissions","level":4,"type":"heading","text":"Step 1. Set up required permissions"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Before you can use dictation, you must add these keys to your appâ€™s "},{"type":"codeVoice","code":"Info.plist"},{"text":":","type":"text"}]},{"syntax":null,"code":["<key>NSMicrophoneUsageDescription<\/key>","<string>Describe why you need microphone access.<\/string>","<key>NSSpeechRecognitionUsageDescription<\/key>","<string>Describe why you need speech recognition.<\/string>"],"type":"codeListing"},{"inlineContent":[{"text":"If you donâ€™t add these keys, your app will crash when you try to start dictation.","type":"text"}],"type":"paragraph"},{"anchor":"Step-2-Create-an-App-Group","type":"heading","level":4,"text":"Step 2. Create an App Group"},{"inlineContent":[{"text":"To share data between an app and its keyboard extension, you must setup a shared app group:","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"identifier":"dictation-appgroup-app.jpg","type":"image"}]},{"inlineContent":[{"identifier":"dictation-appgroup-keyboard.jpg","type":"image"}],"type":"paragraph"},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"While the keyboard will immediately see data written by the app, the app may experience delays in seeing data written by the keyboard, if Full Access isnâ€™t enabled."}]}],"style":"important","name":"Important","type":"aside"},{"text":"Step 3. Create a deep link","type":"heading","anchor":"Step-3-Create-a-deep-link","level":4},{"type":"paragraph","inlineContent":[{"text":"To make it possible for the keyboard to open the app, you must set up a deep link URL scheme:","type":"text"}]},{"type":"paragraph","inlineContent":[{"identifier":"dictation-url-scheme.jpg","type":"image"}]},{"type":"heading","text":"Step 4. Create a keyboard dictation configuration","level":4,"anchor":"Step-4-Create-a-keyboard-dictation-configuration"},{"type":"paragraph","inlineContent":[{"text":"To configure the dictation, create an app-specific ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Dictation\/KeyboardConfiguration"},{"text":" with the App Group ID and deep link that we just set up.","type":"text"}]},{"type":"codeListing","code":["extension KeyboardDictationConfiguration {","","    static let app = .init(","        appGroupId: \"group.com.your-app-name\"    ","        appDeepLink: \"YOUR-URL-SCHEME:\/\/dictation\"","    )","}"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Make sure to add this configuration file to both the main app target and the keyboard extension."}]},{"type":"heading","level":4,"text":"Step 5. Set up dictation in the keyboard extension","anchor":"Step-5-Set-up-dictation-in-the-keyboard-extension"},{"type":"paragraph","inlineContent":[{"text":"To configure dictation for the keyboard extension, set up the ","type":"text"},{"type":"strong","inlineContent":[{"type":"text","text":"dictationContext"}]},{"text":" with the config:","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["class KeyboardViewController: KeyboardInputViewController {","","    override func viewWillSetupKeyboard() {","        super.viewWillSetupKeyboard()","        let keyboardSettings = keyboardSettings","        setupPro(withLicenseKey: \"...\") { license in","            state.dictationContext.setup(with: .app) <-- Here","        } view: { controller in","            \/\/ Return your keyboard view here","        }","    }","} "]},{"anchor":"Step-6-Set-up-dictation-in-the-main-application","level":4,"type":"heading","text":"Step 6. Set up dictation in the main application"},{"inlineContent":[{"type":"text","text":"To configure dictation for the app, first register your KeyboardKit Pro license key:"}],"type":"paragraph"},{"code":["@main","struct MyApp: App {","","    init() {","        registerProLicense()","    }","","    var body: some Scene {","        WindowGroup {","            ContentView()","        }","    }","","    func registerProLicense() {","        Task {","            try? await License.register(licenseKey: \"YOUR-KEY\")","        }","    }","}"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"text":"Then create a ","type":"text"},{"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/DictationContext","isActive":true,"type":"reference"},{"text":" with the ","type":"text"},{"type":"strong","inlineContent":[{"type":"text","text":".app"}]},{"type":"text","text":" config and apply it to the appâ€™s root view:"}]},{"syntax":"swift","type":"codeListing","code":["struct ContentView: View {","","    @StateObject","    var context = DictationContext(config: .app)","","    var body: some View {","        NavigationStack(path: $path) {","            ...","        }","        .keyboardDictation(","            context: context,","            config: .app,","            speechRecognizer: recognizer,   \/\/ See further down","            overlay: overlay","        )","    }","","    func overlay() -> some View {","        Dictation.Screen(","            dictationContext: context,","            titleView: { EmptyView() },","            indicator: { Dictation.BarVisualizer(isAnimating: $0) }","        )","    } ","}"]},{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"inlineContent":[{"type":"text","text":".keyboardDictation"}],"type":"strong"},{"type":"text","text":" modifier has an "},{"inlineContent":[{"type":"text","text":"overlay"}],"type":"strong"},{"text":" parameter that defines the view that should overlay the app while dictation is active.","type":"text"}]},{"inlineContent":[{"text":"You can use KeyboardKit Proâ€™s ","type":"text"},{"inlineContent":[{"type":"text","text":"Dictation.Screen"}],"type":"strong"},{"text":" with any of the built-in dictation visualizers to easily visualize the dictation.","type":"text"}],"type":"paragraph"},{"text":"7. Create a speech recognizer","level":4,"type":"heading","anchor":"7-Create-a-speech-recognizer"},{"type":"paragraph","inlineContent":[{"text":"KeyboardKit Pro doesnâ€™t contain a ","type":"text"},{"code":"SpeechRecognizer","type":"codeVoice"},{"text":", since the ","type":"text"},{"code":"Speech","type":"codeVoice"},{"type":"text","text":" framework would force all apps to specify permissions for dictation, even when not using dictation."}]},{"inlineContent":[{"type":"text","text":"Instead, just copy the code below and use the "},{"type":"strong","inlineContent":[{"text":"StandardSpeechRecognizer","type":"text"}]},{"type":"text","text":" in your dictation."}],"type":"paragraph"},{"syntax":"swift","code":["import Speech","import KeyboardKitPro","","public class StandardSpeechRecognizer: SpeechRecognizer {","","    public init() {}","","    public var supportedLocales: [KeyboardLocale] {","        [","            .english, .arabic, .catalan, .croatian, .czech,","            .danish, .dutch, .dutch_belgium, .english_gb,","            .english_us, .finnish, .french, .french_belgium,","            .french_switzerland, .german, .german_austria,","            .german_switzerland, .greek, .hebrew, .hungarian,","            .indonesian, .italian, .malay, .norwegian, .polish,","            .portuguese, .portuguese_brazil, .romanian, .russian,","            .slovak, .spanish, .swedish, .turkish, .ukrainian","        ]","    }","","    private var resultHandler: ResultHandler?","    private var speechRecognizer: SFSpeechRecognizer?","    private var speechRecognizerRequest: SFSpeechAudioBufferRecognitionRequest?","    private var speechRecognizerTask: SFSpeechRecognitionTask?","}","","public extension StandardSpeechRecognizer {","","    var authorizationStatus: Dictation.AuthorizationStatus {","        SFSpeechRecognizer.authorizationStatus().keyboardDictationStatus","    }","","    func requestDictationAuthorization() async throws -> Dictation.AuthorizationStatus {","        await withCheckedContinuation { continuation in","            SFSpeechRecognizer.requestAuthorization { status in","                continuation.resume(returning: status.keyboardDictationStatus)","            }","        }","    }","","    func resetDictationResult() async throws {}","","    func startDictation(","        with config: Dictation.Configuration","    ) async throws {","        try await startDictation(with: config, resultHandler: nil)","    }","","    func startDictation(","        with config: Dictation.Configuration,","        resultHandler: ResultHandler?","    ) async throws {","        guard let recognizer = setupSpeechRecognizer(for: config) else { throw Dictation.ServiceError.missingSpeechRecognizer }","        guard let request = setupSpeechRecognizerRequest() else { throw Dictation.ServiceError.missingSpeechRecognitionRequest }","        self.resultHandler = resultHandler","        setupSpeechRecognizerTask(for: recognizer, and: request)","    }","","    func stopDictation() async throws {","        speechRecognizerRequest?.endAudio()","        speechRecognizerRequest = nil","        speechRecognizerTask?.cancel()","        speechRecognizerTask = nil","    }","","    func setupAudioEngineBuffer(_ buffer: AVAudioPCMBuffer) {","        speechRecognizerRequest?.append(buffer)","    }","}","","private extension StandardSpeechRecognizer {","","    func setupSpeechRecognizer(for config: Dictation.Configuration) -> SFSpeechRecognizer? {","        let locale = Locale(identifier: config.localeId)","        speechRecognizer = SFSpeechRecognizer(locale: locale)","        return speechRecognizer","    }","","    func setupSpeechRecognizerRequest() -> SFSpeechAudioBufferRecognitionRequest? {","        speechRecognizerRequest = SFSpeechAudioBufferRecognitionRequest()","        speechRecognizerRequest?.shouldReportPartialResults = true","        return speechRecognizerRequest","    }","","    func setupSpeechRecognizerTask(","        for recognizer: SFSpeechRecognizer,","        and request: SFSpeechRecognitionRequest","    ) {","        speechRecognizerTask = recognizer.recognitionTask(with: request) { [weak self] in","            self?.handleTaskResult($0, error: $1)","        }","    }","","    func handleTaskResult(_ result: SFSpeechRecognitionResult?, error: Error?) {","        let result = SpeechRecognizerResult(","            dictatedText: result?.bestTranscription.formattedString,","            error: error,","            isFinal: result?.isFinal ?? true)","        resultHandler?(result)","    }","}"],"type":"codeListing"},{"level":4,"type":"heading","anchor":"8-Perform-dictation","text":"8. Perform dictation"},{"type":"paragraph","inlineContent":[{"type":"text","text":"You can now start dictation in your keyboard by triggering a "},{"type":"reference","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardAction\/dictation","isActive":true},{"type":"text","text":" action or calling "},{"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardDictationService\/startDictationFromKeyboard(with:)","type":"reference","isActive":true},{"text":".","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"If everything is correctly configured, the keyboard should open the app to start dictation. When the user returns to the keyboard, it will automatically send the dictated text to the text field."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"You can override "},{"isActive":true,"type":"reference","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardInputViewController\/viewWillHandleDictationResult()"},{"type":"text","text":" to customize how the keyboard handles the dictated text."}]},{"type":"aside","name":"Important","style":"important","content":[{"inlineContent":[{"text":"In a DocumentGroup, the .keyboardDictation modifier only works if a document is open. To work around this, check if isDictationStartedByKeyboard is true. If so, present a sheet or modal and add .keyboardDictationOnAppear to its root view.","type":"text"}],"type":"paragraph"}]},{"level":4,"type":"heading","anchor":"9-Return-to-the-keyboard","text":"9. Return to the keyboard"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Once dictation is done, the app should return to the keyboard to let it handle the dictated text."}]},{"inlineContent":[{"text":"KeyboardKit Pro used to have a ","type":"text"},{"type":"strong","inlineContent":[{"text":"PreviousAppNavigator","type":"text"}]},{"text":" that was used to navigate back to the keyboard, but it stopped working in iOS 17. A new implementation was then rejected by Apple.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Since KeyboardKit canâ€™t add this to the library, you have to implement the return operation, or instruct your users to tap the back button to return to the keyboard."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"To implement it, inherit "},{"type":"strong","inlineContent":[{"text":"ProKeyboardDictationService","type":"text"}]},{"text":" and override ","type":"text"},{"inlineContent":[{"text":"tryToReturnToKeyboard","type":"text"}],"type":"strong"},{"type":"text","text":":"}]},{"code":["class CustomDictationService: ProKeyboardDictationService {","","    override func tryToReturnToKeyboard() {","        \/\/ Add your code here","    }","}"],"syntax":"swift","type":"codeListing"},{"type":"paragraph","inlineContent":[{"text":"You can then inject your custom service into the ","type":"text"},{"type":"strong","inlineContent":[{"type":"text","text":"keyboardDictation"}]},{"type":"text","text":" modifier."}]},{"type":"heading","level":4,"anchor":"10-Rejected-back-navigation-implementations","text":"10. Rejected back navigation implementations"},{"type":"paragraph","inlineContent":[{"text":"See the ","type":"text"},{"type":"reference","isActive":true,"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Navigation-Article"},{"type":"text","text":" for the two implementations that were previously used by the library. Although they may be rejected by Apple, they may give you some inspiration."}]}],"kind":"content"}],"references":{"doc://KeyboardKit/documentation/KeyboardKit/Settings-Article":{"url":"\/documentation\/keyboardkit\/settings-article","abstract":[{"text":"This article describes the KeyboardKit settings engine.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Settings-Article","role":"article","kind":"article","title":"Settings"},"doc://KeyboardKit/documentation/KeyboardKit/Extensions-Article":{"url":"\/documentation\/keyboardkit\/extensions-article","abstract":[{"text":"This article describes KeyboardKit native type extensions.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Extensions-Article","role":"article","kind":"article","title":"Extensions"},"doc://KeyboardKit/documentation/KeyboardKit":{"title":"KeyboardKit","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit","url":"\/documentation\/keyboardkit","role":"collection","abstract":[{"text":"KeyboardKit helps you create custom keyboard extensions with Swift and SwiftUI.","type":"text"}],"kind":"symbol","type":"topic"},"dictation-url-scheme.jpg":{"alt":"Set up a URL Scheme for the app","identifier":"dictation-url-scheme.jpg","variants":[{"url":"\/images\/dictation-url-scheme.jpg","traits":["1x","light"]}],"type":"image"},"doc://KeyboardKit/documentation/KeyboardKit/Views":{"url":"\/documentation\/keyboardkit\/views","abstract":[{"text":"This article describes various KeyboardKit views.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Views","role":"article","kind":"article","title":"Views"},"doc://KeyboardKit/documentation/KeyboardKit/Proxy-Utilities-Article":{"url":"\/documentation\/keyboardkit\/proxy-utilities-article","abstract":[{"text":"This article describes the KeyboardKit proxy engine and its utilities.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Proxy-Utilities-Article","role":"article","kind":"article","title":"Proxy Utilities"},"doc://KeyboardKit/documentation/KeyboardKit/KeyboardContext":{"title":"KeyboardContext","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardContext","fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"KeyboardContext"}],"url":"\/documentation\/keyboardkit\/keyboardcontext","role":"symbol","navigatorTitle":[{"kind":"identifier","text":"KeyboardContext"}],"kind":"symbol","abstract":[{"text":"This class provides keyboard extensions with contextual and","type":"text"},{"text":" ","type":"text"},{"text":"observable information about the keyboard extension itself.","type":"text"}],"type":"topic"},"dictation-appgroup-keyboard.jpg":{"identifier":"dictation-appgroup-keyboard.jpg","variants":[{"traits":["1x","light"],"url":"\/images\/dictation-appgroup-keyboard.jpg"}],"alt":"Set up an App Group for the keyboard","type":"image"},"doc://KeyboardKit/documentation/KeyboardKit/Layout-Article":{"url":"\/documentation\/keyboardkit\/layout-article","abstract":[{"type":"text","text":"This article describes the KeyboardKit layout engine."}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Layout-Article","role":"article","kind":"article","title":"Layout"},"doc://KeyboardKit/documentation/KeyboardKit/Text-Routing-Article":{"url":"\/documentation\/keyboardkit\/text-routing-article","abstract":[{"type":"text","text":"This article describes the KeyboardKit text routing engine."}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Text-Routing-Article","role":"article","kind":"article","title":"Text Routing"},"doc://KeyboardKit/documentation/KeyboardKit/KeyboardInputViewController/services":{"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardInputViewController\/services","abstract":[{"type":"text","text":"The default set of keyboard-specific services."}],"role":"symbol","type":"topic","title":"services","kind":"symbol","url":"\/documentation\/keyboardkit\/keyboardinputviewcontroller\/services","fragments":[{"text":"var","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"services"},{"kind":"text","text":": "},{"text":"Keyboard","kind":"typeIdentifier","preciseIdentifier":"s:11KeyboardKit0A0V"},{"kind":"text","text":"."},{"kind":"typeIdentifier","preciseIdentifier":"s:11KeyboardKit0A0V0A8ServicesC","text":"KeyboardServices"}]},"doc://KeyboardKit/documentation/KeyboardKit/Actions-Article":{"url":"\/documentation\/keyboardkit\/actions-article","abstract":[{"type":"text","text":"This article describes the KeyboardKit action engine."}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Actions-Article","role":"article","kind":"article","title":"Actions"},"doc://KeyboardKit/documentation/KeyboardKit/Feedback-Article":{"url":"\/documentation\/keyboardkit\/feedback-article","abstract":[{"text":"This article describes the KeyboardKit feedback engine.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Feedback-Article","role":"article","kind":"article","title":"Feedback"},"doc://KeyboardKit/documentation/KeyboardKit/Emojis-Article":{"url":"\/documentation\/keyboardkit\/emojis-article","abstract":[{"text":"This article describes the KeyboardKit emoji engine.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Emojis-Article","role":"article","kind":"article","title":"Emojis"},"doc://KeyboardKit/documentation/KeyboardKit/DictationContext":{"url":"\/documentation\/keyboardkit\/dictationcontext","navigatorTitle":[{"text":"DictationContext","kind":"identifier"}],"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/DictationContext","fragments":[{"text":"class","kind":"keyword"},{"kind":"text","text":" "},{"text":"DictationContext","kind":"identifier"}],"kind":"symbol","type":"topic","title":"DictationContext","abstract":[{"type":"text","text":"This context can be used to handle regular in-app dictation"},{"type":"text","text":" "},{"text":"and keyboard-based dictation.","type":"text"}],"role":"symbol"},"doc://KeyboardKit/documentation/KeyboardKit/Dictation/KeyboardConfiguration":{"abstract":[{"text":"This can be used with a ","type":"text"},{"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardDictationService","type":"reference","isActive":true},{"type":"text","text":"."}],"title":"Dictation.KeyboardConfiguration","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Dictation\/KeyboardConfiguration","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"KeyboardConfiguration"}],"navigatorTitle":[{"text":"KeyboardConfiguration","kind":"identifier"}],"type":"topic","url":"\/documentation\/keyboardkit\/dictation\/keyboardconfiguration","kind":"symbol","role":"symbol"},"doc://KeyboardKit/documentation/KeyboardKit/External-Keyboards-Article":{"url":"\/documentation\/keyboardkit\/external-keyboards-article","abstract":[{"text":"This article describes the KeyboardKit external keyboard engine.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/External-Keyboards-Article","role":"article","kind":"article","title":"External Keyboards"},"doc://KeyboardKit/documentation/KeyboardKit/KeyboardDictationService/startDictationFromKeyboard(with:)":{"required":true,"kind":"symbol","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardDictationService\/startDictationFromKeyboard(with:)","abstract":[{"text":"Start a dictation operation from the keyboard.","type":"text"}],"url":"\/documentation\/keyboardkit\/keyboarddictationservice\/startdictationfromkeyboard(with:)","title":"startDictationFromKeyboard(with:)","type":"topic","role":"symbol","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"text":"startDictationFromKeyboard","kind":"identifier"},{"kind":"text","text":"("},{"text":"with","kind":"externalParam"},{"text":": ","kind":"text"},{"text":"Dictation","kind":"typeIdentifier","preciseIdentifier":"s:11KeyboardKit9DictationV"},{"kind":"text","text":"."},{"preciseIdentifier":"s:11KeyboardKit9DictationV0A13ConfigurationV","text":"KeyboardConfiguration","kind":"typeIdentifier"},{"text":") ","kind":"text"},{"text":"async","kind":"keyword"},{"text":" ","kind":"text"},{"text":"throws","kind":"keyword"}]},"doc://KeyboardKit/documentation/KeyboardKit/AI-Article":{"url":"\/documentation\/keyboardkit\/ai-article","abstract":[{"text":"This article describes the KeyboardKit AI support capabilities.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/AI-Article","role":"article","kind":"article","title":"AI Support"},"doc://KeyboardKit/documentation/KeyboardKit/Previews-Article":{"url":"\/documentation\/keyboardkit\/previews-article","abstract":[{"text":"This article describes the KeyboardKit preview engine.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Previews-Article","role":"article","kind":"article","title":"Previews"},"doc://KeyboardKit/documentation/KeyboardKit/Navigation-Article":{"url":"\/documentation\/keyboardkit\/navigation-article","abstract":[{"text":"This article describes the KeyboardKit navigation engine.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Navigation-Article","role":"article","kind":"article","title":"Navigation"},"doc://KeyboardKit/documentation/KeyboardKit/Autocomplete-Article":{"url":"\/documentation\/keyboardkit\/autocomplete-article","abstract":[{"text":"This article describes the KeyboardKit autocomplete engine.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Autocomplete-Article","role":"article","kind":"article","title":"Autocomplete"},"doc://KeyboardKit/documentation/KeyboardKit/KeyboardInputViewController/viewWillHandleDictationResult()":{"type":"topic","role":"symbol","fragments":[{"text":"func","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"viewWillHandleDictationResult"},{"text":"()","kind":"text"}],"title":"viewWillHandleDictationResult()","url":"\/documentation\/keyboardkit\/keyboardinputviewcontroller\/viewwillhandledictationresult()","kind":"symbol","abstract":[{"type":"text","text":"This function is called to handle any dictation results"},{"text":" ","type":"text"},{"text":"when returning from the main app.","type":"text"}],"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardInputViewController\/viewWillHandleDictationResult()"},"doc://KeyboardKit/documentation/KeyboardKit/Buttons-Article":{"url":"\/documentation\/keyboardkit\/buttons-article","abstract":[{"type":"text","text":"This article describes various KeyboardKit buttons."}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Buttons-Article","role":"article","kind":"article","title":"Buttons"},"doc://KeyboardKit/documentation/KeyboardKit/KeyboardAction/dictation":{"kind":"symbol","abstract":[{"text":"Represents a dictation key, which are not included by the standard layouts.","type":"text"}],"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardAction\/dictation","url":"\/documentation\/keyboardkit\/keyboardaction\/dictation","type":"topic","title":"KeyboardAction.dictation","role":"symbol","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"dictation","kind":"identifier"}]},"doc://KeyboardKit/documentation/KeyboardKit/Gestures-Article":{"url":"\/documentation\/keyboardkit\/gestures-article","abstract":[{"text":"This article describes the KeyboardKit gesture engine.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Gestures-Article","role":"article","kind":"article","title":"Gestures"},"doc://KeyboardKit/documentation/KeyboardKit/Images-Article":{"url":"\/documentation\/keyboardkit\/images-article","abstract":[{"text":"This article describes the KeyboardKit keyboard image engine.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Images-Article","role":"article","kind":"article","title":"Images"},"doc://KeyboardKit/documentation/KeyboardKit/DictationService":{"fragments":[{"kind":"keyword","text":"protocol"},{"text":" ","kind":"text"},{"kind":"identifier","text":"DictationService"}],"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/DictationService","url":"\/documentation\/keyboardkit\/dictationservice","type":"topic","kind":"symbol","role":"symbol","title":"DictationService","navigatorTitle":[{"kind":"identifier","text":"DictationService"}],"abstract":[{"text":"This protocol can be implemented by classes that can handle","type":"text"},{"type":"text","text":" "},{"text":"dictation, e.g. by using the device microphone.","type":"text"}]},"doc://KeyboardKit/documentation/KeyboardKit/Colors-Article":{"url":"\/documentation\/keyboardkit\/colors-article","abstract":[{"text":"This article describes the KeyboardKit color engine.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Colors-Article","role":"article","kind":"article","title":"Colors"},"https://github.com/KeyboardKit/KeyboardKitPro":{"url":"https:\/\/github.com\/KeyboardKit\/KeyboardKitPro","identifier":"https:\/\/github.com\/KeyboardKit\/KeyboardKitPro","titleInlineContent":[{"type":"text","text":"KeyboardKit Pro"}],"title":"KeyboardKit Pro","type":"link"},"doc://KeyboardKit/documentation/KeyboardKit/Dictation":{"fragments":[{"text":"struct","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"Dictation"}],"url":"\/documentation\/keyboardkit\/dictation","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Dictation","kind":"symbol","type":"topic","title":"Dictation","abstract":[{"type":"text","text":"This namespace contains dictation-related types, as well as"},{"type":"text","text":" "},{"type":"text","text":"disabled service implementations."}],"navigatorTitle":[{"text":"Dictation","kind":"identifier"}],"role":"symbol"},"doc://KeyboardKit/documentation/KeyboardKit/DictationService/requestDictationAuthorization()":{"title":"requestDictationAuthorization()","role":"symbol","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"requestDictationAuthorization"},{"text":"() ","kind":"text"},{"text":"async","kind":"keyword"},{"kind":"text","text":" "},{"kind":"keyword","text":"throws"},{"text":" -> ","kind":"text"},{"kind":"typeIdentifier","preciseIdentifier":"s:11KeyboardKit9DictationV","text":"Dictation"},{"text":".","kind":"text"},{"preciseIdentifier":"s:11KeyboardKit9DictationV19AuthorizationStatusO","kind":"typeIdentifier","text":"AuthorizationStatus"}],"kind":"symbol","type":"topic","url":"\/documentation\/keyboardkit\/dictationservice\/requestdictationauthorization()","required":true,"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/DictationService\/requestDictationAuthorization()","abstract":[{"text":"Request dictation authorization.","type":"text"}]},"doc://KeyboardKit/documentation/KeyboardKit/Device-Article":{"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Device-Article","url":"\/documentation\/keyboardkit\/device-article","type":"topic","abstract":[{"type":"text","text":"This article describes various KeyboardKit device utilities."}],"kind":"article","title":"Device Utilities","role":"article"},"doc://KeyboardKit/documentation/KeyboardKit/Localization-Article":{"url":"\/documentation\/keyboardkit\/localization-article","abstract":[{"text":"This article describes the KeyboardKit localization engine.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Localization-Article","role":"article","kind":"article","title":"Localization"},"doc://KeyboardKit/documentation/KeyboardKit/DictationService/startDictation(with:)":{"title":"startDictation(with:)","abstract":[{"type":"text","text":"Start dictating with the provided configuration."}],"url":"\/documentation\/keyboardkit\/dictationservice\/startdictation(with:)","type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/DictationService\/startDictation(with:)","required":true,"role":"symbol","kind":"symbol","fragments":[{"kind":"keyword","text":"func"},{"text":" ","kind":"text"},{"text":"startDictation","kind":"identifier"},{"text":"(","kind":"text"},{"text":"with","kind":"externalParam"},{"kind":"text","text":": "},{"text":"Dictation","kind":"typeIdentifier","preciseIdentifier":"s:11KeyboardKit9DictationV"},{"text":".","kind":"text"},{"preciseIdentifier":"s:11KeyboardKit9DictationV13ConfigurationV","text":"Configuration","kind":"typeIdentifier"},{"kind":"text","text":") "},{"text":"async","kind":"keyword"},{"text":" ","kind":"text"},{"text":"throws","kind":"keyword"}]},"doc://KeyboardKit/documentation/KeyboardKit/Callouts-Article":{"url":"\/documentation\/keyboardkit\/callouts-article","abstract":[{"text":"This article describes the KeyboardKit callout engine.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Callouts-Article","role":"article","kind":"article","title":"Callouts"},"doc://KeyboardKit/documentation/KeyboardKit/Themes-Article":{"url":"\/documentation\/keyboardkit\/themes-article","abstract":[{"text":"This article describes the KeyboardKit theme engine.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Themes-Article","role":"article","kind":"article","title":"Themes"},"doc://KeyboardKit/documentation/KeyboardKit/State-Article":{"url":"\/documentation\/keyboardkit\/state-article","abstract":[{"type":"text","text":"This article describes the KeyboardKit state engine."}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/State-Article","role":"article","kind":"article","title":"State"},"doc://KeyboardKit/documentation/KeyboardKit/Styling-Article":{"url":"\/documentation\/keyboardkit\/styling-article","abstract":[{"text":"This article describes the KeyboardKit styling engine.","type":"text"}],"type":"topic","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/Styling-Article","role":"article","kind":"article","title":"Styling"},"dictationscreen-350.jpg":{"identifier":"dictationscreen-350.jpg","variants":[{"traits":["1x","light"],"url":"\/images\/dictationscreen-350.jpg"}],"alt":"DictationScreen","type":"image"},"doc://KeyboardKit/documentation/KeyboardKit/KeyboardInputViewController/state":{"type":"topic","role":"symbol","kind":"symbol","identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardInputViewController\/state","url":"\/documentation\/keyboardkit\/keyboardinputviewcontroller\/state","title":"state","abstract":[{"type":"text","text":"The default set of keyboard-specific state."}],"fragments":[{"text":"var","kind":"keyword"},{"text":" ","kind":"text"},{"text":"state","kind":"identifier"},{"text":": ","kind":"text"},{"text":"Keyboard","preciseIdentifier":"s:11KeyboardKit0A0V","kind":"typeIdentifier"},{"text":".","kind":"text"},{"preciseIdentifier":"s:11KeyboardKit0A0V0A5StateC","text":"KeyboardState","kind":"typeIdentifier"}]},"dictation-appgroup-app.jpg":{"alt":"Set up an App Group for the app","identifier":"dictation-appgroup-app.jpg","variants":[{"url":"\/images\/dictation-appgroup-app.jpg","traits":["1x","light"]}],"type":"image"},"doc://KeyboardKit/documentation/KeyboardKit/KeyboardDictationService":{"title":"KeyboardDictationService","abstract":[{"type":"text","text":"This protocol can be implemented by classes that can handle"},{"type":"text","text":" "},{"text":"dictations between a keyboard extension and its parent app.","type":"text"}],"identifier":"doc:\/\/KeyboardKit\/documentation\/KeyboardKit\/KeyboardDictationService","fragments":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"KeyboardDictationService"}],"navigatorTitle":[{"text":"KeyboardDictationService","kind":"identifier"}],"kind":"symbol","url":"\/documentation\/keyboardkit\/keyboarddictationservice","type":"topic","role":"symbol"}}}